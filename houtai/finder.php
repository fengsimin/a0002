<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\x61\164\141\57\146\x69\156\x64\x65\x72\57"; function __construct() { goto zq5yW; mMgDy: parent::__construct(); goto ltc5S; l40Js: zNZ8t: goto mMgDy; x6eC0: $this->table = "\x66\151\x6e\x64\145\162"; goto l40Js; zq5yW: if ($this->table) { goto zNZ8t; } goto x6eC0; ltc5S: } protected function postAll($pid, $request_data) { goto s6Xfo; yfvvd: if (!$pid) { goto dJtbh; } goto i2xg1; XEAdI: dJtbh: goto DxPXq; i2xg1: $level = $this->db->select($this->table, "\x6c\x65\x76\x65\x6c")->where(array("\151\144", "\x3d", $pid))->get(0); goto OMITF; sRNvH: $paths = array(); goto yfvvd; DxPXq: return array("\146\x69\154\145\x73" => $files, "\160\141\x74\150\163" => $paths); goto IjWdr; s6Xfo: $files = $this->db->select($this->table)->where($request_data["\x77\x68\145\x72\x65"])->order($request_data["\x6f\x72\x64\145\162"])->all(); goto sRNvH; OMITF: $level = array_filter(explode("\54", $level)); goto qOwA_; qOwA_: $paths = $this->db->select($this->table, array("\151\x64", "\x6e\x61\155\x65"))->where(array("\151\x64", "\x49\x4e", $level), "\101\x4e\104", array("\164\x79\x70\145", "\x3d", "\146\157\154\144\x65\162"))->all(); goto XEAdI; IjWdr: } protected function postAdd($request_data) { goto seWLE; seWLE: $path = $request_data["\160\x61\x74\150"]; goto sG8nE; hQoDF: x65ls: goto xc0HE; hGI2K: $this->db->commit(); goto P5j_Q; iUMHG: Abh6W: goto rKi5Z; TCz9U: $data["\164\171\x70\145"] = $type; goto VoMD5; OOiCE: $data["\x6e\141\155\145"] = $name; goto TCz9U; x3rQh: if (!$this->db->update($this->table, array("\x6c\x65\166\x65\x6c" => $level), array("\151\144", "\75", $id))->is()) { goto x65ls; } goto hGI2K; lS3qM: return $this->error("\345\210\233\345\xbb\272\xe6\x96\207\344\273\266\xe5\xa4\xb9\xe5\244\261\350\xb4\245\357\274\x81"); goto npxa1; P5j_Q: return $this->success(); goto hQoDF; Jn19p: return $this->error("\xe4\270\212\344\xbc\240\xe6\x96\207\xe4\xbb\xb6\40" . $name . "\x20\345\xa4\xb1\xe8\264\xa5\357\xbc\201"); goto o3DZa; AVytq: $foid = $request_data["\146\x6f\151\144"]; goto YYRDf; dgE5t: $this->db->beginTransaction(); goto gngUL; sG8nE: $name = $request_data["\156\141\x6d\x65"]; goto QFW84; xc0HE: $this->db->rollBack(); goto Jn19p; Ptil1: $data["\167\151\144\164\x68"] = $imagesize[0]; goto Syecp; rKi5Z: $filename = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto kn38q; afy3Y: if (mkdir($this->_UTF82GBK("\56\56\57" . $path), 511, true)) { goto GjadU; } goto lS3qM; WEmfj: LDcSu: goto mL6x_; ccUIe: $data["\143\164\x69\155\x65"] = time(); goto qZOvX; mL6x_: $level = $this->_getLevel($id); goto x3rQh; khArh: $data["\163\151\172\145"] = $request_data["\163\151\172\x65"]; goto ccUIe; YYRDf: if (is_dir($this->_UTF82GBK("\x2e\x2e\57" . $path))) { goto Abh6W; } goto afy3Y; fcijV: unlink($filename); goto ccAmL; npxa1: GjadU: goto iUMHG; c4752: return $this->error("\xe4\xb8\212\xe4\xbc\xa0\xe6\x96\207\344\xbb\xb6\x20" . $name . "\x20\xe5\xa4\xb1\xe8\xb4\xa5\357\xbc\x81"); goto WEmfj; kn38q: if (!(stripos($type, "\151\x6d\x61\147\145") !== false && is_file($filename))) { goto Cnk9K; } goto odigp; gngUL: if ($id = $this->db->insert($this->table, $data)->id()) { goto LDcSu; } goto fcijV; ccAmL: $this->db->rollBack(); goto c4752; VoMD5: $data["\160\x69\x64"] = $foid ? $foid : 0; goto khArh; odigp: $imagesize = getimagesize($filename); goto Ptil1; qZOvX: $data["\145\x78\164"] = end(explode("\x2e", $name)); goto dgE5t; ethsp: Cnk9K: goto l6BPC; QFW84: $type = mime_content_type("\x2e\56\x2f" . $path . $name); goto AVytq; l6BPC: $data["\x70\x61\164\x68"] = $path; goto OOiCE; Syecp: $data["\x68\x65\x69\x67\x68\x74"] = $imagesize[1]; goto ethsp; o3DZa: } protected function postMkdir($request_data) { goto ekdgl; jwIkd: $data["\160\x61\x74\150"] = $this->root . $folder_path; goto kma2p; j_mrW: rmdir($dirname); goto IE6QQ; lQwbI: $level = $this->_getLevel($id); goto GGRvA; shsnL: qpi2b: goto lQwbI; xFUOF: return $this->error($name . "\x20\xe6\x96\x87\344\xbb\xb6\xe5\xa4\271\345\xb7\xb2\345\xad\230\xe5\234\250\xef\xbc\x81"); goto ab7qT; RGr0n: $data["\156\x61\x6d\145"] = $name; goto efa_5; AtyRw: $data = array(); goto RGr0n; CLpq2: $folder_path = ''; goto B9ACm; kyu2a: if (mkdir($dirname, 493, true)) { goto awh31; } goto kaAMx; Z_rmN: return $this->error("\346\x97\xa0\346\x95\210\347\x9a\204\xe5\x8f\x82\xe6\x95\260\xef\xbc\201"); goto RrafP; xUDir: X1qp9: goto YLR3R; IFNBf: Jql0X: goto xUDir; kma2p: $data["\x73\x6f\x72\164\142\171"] = 1; goto miXJa; uAOpT: $this->db->rollBack(); goto cFHKr; taTNL: if (!is_dir($dirname)) { goto kIG24; } goto xFUOF; sZ3om: $data["\x63\x74\151\155\145"] = time(); goto QLjRQ; efa_5: $data["\160\x69\x64"] = $pid; goto CLpq2; ekdgl: $pid = $request_data["\x70\x69\x64"]; goto ZkoN5; ypRot: $folder = $this->db->select($this->table, "\x60\156\141\x6d\145\140")->where(array("\151\144", "\111\x4e", $level), "\101\x4e\x44", array("\164\x79\x70\x65", "\75", "\146\157\x6c\x64\145\162"))->all(); goto A33Zn; sCEAK: rmdir($dirname); goto uAOpT; GGRvA: if ($this->db->update($this->table, array("\x6c\x65\x76\x65\154" => $level), array("\x69\x64", "\75", $id))->is()) { goto Pc1C5; } goto sCEAK; LMeL8: $this->db->commit(); goto HksKu; EsDkx: if (!$level) { goto X1qp9; } goto apDsh; B9ACm: $level = $this->db->select($this->table, "\140\x6c\145\166\145\154\x60")->where(array("\x69\x64", "\x3d", $pid))->get(0); goto EsDkx; ab7qT: kIG24: goto kyu2a; YvIFV: Pc1C5: goto LMeL8; y30Lx: if (!($name === null || $name === '')) { goto mIQXe; } goto Z_rmN; kaAMx: return $this->error("\xe5\x88\233\345\xbb\272\xe6\226\x87\xe4\273\266\345\244\271\xe5\xa4\xb1\350\264\xa5\357\xbc\x81"); goto QuPxc; cFHKr: return $this->error("\xe5\x88\x9b\345\xbb\272\346\226\207\xe4\273\xb6\345\244\xb9\345\xa4\xb1\xe8\xb4\245\357\xbc\201"); goto CJK3h; apDsh: $level = array_filter(explode("\54", $level)); goto ypRot; auGQB: return $this->error("\xe5\210\x9b\345\273\272\xe6\x96\207\xe4\xbb\266\345\244\271\345\244\xb1\350\xb4\245\xef\274\201"); goto shsnL; IE6QQ: $this->db->rollBack(); goto auGQB; YLR3R: $dirname = $this->_UTF82GBK("\56\56\x2f" . $this->root . $folder_path . $name); goto taTNL; kV3OG: $this->db->beginTransaction(); goto jwIkd; QuPxc: awh31: goto kV3OG; QLjRQ: if ($id = $this->db->insert($this->table, $data)->id()) { goto qpi2b; } goto j_mrW; miXJa: $data["\164\171\160\x65"] = "\146\157\x6c\x64\145\162"; goto sZ3om; A33Zn: foreach ($folder as $value) { $folder_path .= $value["\156\141\x6d\x65"] . "\x2f"; WQ2RY: } goto IFNBf; CJK3h: goto CL0i2; goto YvIFV; RrafP: mIQXe: goto AtyRw; ZkoN5: $name = $request_data["\156\141\155\145"]; goto y30Lx; UOJk7: CL0i2: goto RclDM; HksKu: return $this->success(); goto UOJk7; RclDM: } protected function postRename($request_data) { goto syOG3; g1l69: $path = $finder["\x70\141\164\x68"]; goto tUC1Z; iUACl: $this->db->rollBack(); goto xOeGQ; oDaJB: PqXJc: goto yLXAM; Ep0GI: $this->db->rollBack(); goto Otiuh; Zjh5C: WoByo: goto wDWuF; syOG3: $id = $request_data["\x69\144"]; goto U9i0K; kkQhK: KZGSE: goto L8mIR; tUC1Z: if (!(!$path || stripos($path, $this->root) === false)) { goto xf153; } goto OccfF; m4q5D: if (is_file($oldname)) { goto Rm6W3; } goto vOekw; JIHHg: IqpHQ: goto dlB5_; lnu8O: $this->db->rollBack(); goto sKK7I; Vr8Op: hKKwx: goto tQstd; xeeFr: Xn6ps: goto kkQhK; ee2_h: Rm6W3: goto b4QJH; DcuXA: N_lxU: goto invkQ; SoQUc: goto Pxp7M; goto Gg9Tx; quKR_: owP7W: goto V9V3Z; vOekw: if (is_dir($oldname)) { goto Z2T3c; } goto R41xO; yLXAM: $this->db->commit(); goto tns46; xO7N3: Pxp7M: goto quKR_; xOeGQ: return $this->error("\xe6\226\x87\344\273\266\xe9\x87\215\345\x91\275\345\220\x8d\xe5\xa4\261\xe8\264\245\xef\274\x81"); goto IjmOz; sKK7I: return $this->error($name . "\x20\xe6\226\x87\xe4\xbb\xb6\xe5\xa4\271\xe5\xb7\262\345\xad\x98\xe5\234\xa8\357\xbc\201"); goto XHXX3; uIB61: Z2T3c: goto G8LER; G8LER: if ($this->db->update($this->table, array("\x6e\x61\155\x65" => $name), array("\151\144", "\75", $id))->is()) { goto ZoXfo; } goto NdgC0; XHXX3: goto uzfmJ; goto DcuXA; R41xO: return $this->error("\xe6\211\xbe\344\xb8\215\345\210\xb0\xe9\x87\215\xe5\x91\275\xe5\220\x8d\xe7\232\x84\346\226\x87\344\273\xb6\x2f\xe6\226\207\xe4\xbb\xb6\xe5\xa4\xb9\xef\xbc\x81"); goto D0DRq; bQfRj: rename($newname, $oldname); goto Ep0GI; D0DRq: goto owP7W; goto ee2_h; Otiuh: return $this->error("\346\x96\x87\xe4\273\xb6\345\xa4\271\xe9\x87\x8d\xe5\x91\xbd\345\220\x8d\345\244\xb1\xe8\xb4\xa5\357\274\201"); goto lKInF; lKInF: goto WoByo; goto JIHHg; GNOES: return $this->error("\xe6\226\207\xe4\xbb\xb6\xe9\207\x8d\xe5\221\xbd\345\x90\215\xe5\244\xb1\xe8\xb4\xa5\xef\xbc\x81"); goto tSowW; EMhus: if ($is_path_update !== false) { goto IqpHQ; } goto bQfRj; IjmOz: goto Xn6ps; goto oDaJB; b4QJH: if ($this->db->update($this->table, array("\156\x61\x6d\x65" => $name), array("\x69\144", "\x3d", $id))->is()) { goto E7f3_; } goto aCVyq; Gg9Tx: ZoXfo: goto wQgti; ESh5M: $this->db->beginTransaction(); goto m4q5D; omcXa: E7f3_: goto fDRZU; CTumF: xf153: goto sUCGz; wQgti: if (rename($oldname, $newname)) { goto N_lxU; } goto lnu8O; Y2Uqt: if (!(!$id || $name === null || $name === '')) { goto hKKwx; } goto bKc7j; aCVyq: $this->db->rollBack(); goto GNOES; wDWuF: uzfmJ: goto xO7N3; tQstd: $finder = $this->db->select($this->table, array("\x70\141\164\150", "\156\x61\x6d\145", "\x6c\x65\x76\x65\154"))->where(array("\x69\x64", "\x3d", $id))->get(); goto g1l69; EDXE4: return $this->success(); goto Zjh5C; fDRZU: if (rename($oldname, $newname)) { goto PqXJc; } goto iUACl; tSowW: goto KZGSE; goto omcXa; tns46: return $this->success(); goto xeeFr; OccfF: return $this->error("\346\x97\240\xe6\225\x88\xe7\x9a\x84\350\xb7\xaf\xe5\276\x84\xef\xbc\x81"); goto CTumF; U9i0K: $name = $request_data["\156\x61\x6d\145"]; goto Y2Uqt; invkQ: $sublist = $this->db->select($this->table, array("\151\144", "\154\x65\x76\x65\154", "\164\171\160\x65"))->where(array("\154\145\166\x65\154", "\114\x49\x4b\105", "\45\x2c{$id}\54\45"))->all(); goto SVNjN; MTNxm: return $this->error("\xe6\x96\x87\xe4\xbb\xb6\345\244\xb9\xe9\x87\215\xe5\221\xbd\345\x90\215\xe5\244\261\350\264\245\357\274\201"); goto SoQUc; L8mIR: goto owP7W; goto uIB61; SVNjN: foreach ($sublist as $sub) { goto aWwaa; Pv88p: aOxWh: goto Dexbg; NYu2A: if (!($is_path_update === false)) { goto aOxWh; } goto A0GOs; LSzu2: BBMw5: goto SvQIq; Gz2ZL: goto BrIWM; goto LSzu2; a7Ygj: $is_path_update = $this->db->update($this->table, array("\160\x61\x74\x68" => $this->root . $newpath), array("\x69\x64", "\x3d", $sub["\151\x64"]))->is(); goto NYu2A; SvQIq: $newpath = ''; goto rI1s9; Bxfyy: AG8rP: goto a7Ygj; aWwaa: if (!($sub["\x6c\145\x76\x65\x6c"] == $finder["\x6c\145\x76\145\154"])) { goto BBMw5; } goto Gz2ZL; A0GOs: goto EaRww; goto Pv88p; Dexbg: BrIWM: goto OM4dV; rI1s9: $level = array_filter(explode("\54", $sub["\x6c\x65\x76\x65\x6c"])); goto NVPVz; NVPVz: foreach ($level as $lid) { goto nvP2Z; nvP2Z: $levelobj = $this->db->select($this->table, array("\x6e\141\x6d\x65", "\x6c\x65\x76\145\154"))->where("\151\x64\x20\75\x20{$lid}\40\101\116\104\x20\x74\x79\x70\145\40\x3d\x20\x27\146\x6f\154\144\145\x72\47")->get(); goto sFikw; OZLfy: afWRN: goto pD4_W; rvDj2: goto oJazN; goto OZLfy; SEyHl: $newpath .= $level_name != '' ? $level_name . "\57" : ''; goto g1wIZ; sFikw: if (!($sub["\x74\x79\x70\145"] == "\x66\x6f\x6c\144\x65\x72" && $sub["\154\x65\x76\x65\154"] == $levelobj["\154\x65\x76\x65\x6c"])) { goto afWRN; } goto rvDj2; g1wIZ: oJazN: goto RWL5V; pD4_W: $level_name = $levelobj["\156\x61\155\145"]; goto SEyHl; RWL5V: } goto Bxfyy; OM4dV: } goto K5_lG; ffecY: $newname = $this->_UTF82GBK("\56\x2e\57" . $path . $name); goto ESh5M; bKc7j: return $this->error("\346\227\240\346\x95\210\347\x9a\204\xe5\x8f\x82\xe6\x95\260\357\274\201"); goto Vr8Op; NdgC0: $this->db->rollBack(); goto MTNxm; K5_lG: EaRww: goto EMhus; sUCGz: $oldname = $this->_UTF82GBK("\x2e\x2e\x2f" . $path . $finder["\156\x61\155\x65"]); goto ffecY; dlB5_: $this->db->commit(); goto EDXE4; V9V3Z: } protected function postIsFile($request_data) { goto z4lZy; mCmiF: $name = $request_data["\x6e\x61\155\x65"]; goto RcT2x; IxZDI: goto BdSHy; goto vn3hj; XGHg4: return $this->error($name . "\40\346\226\x87\xe4\273\xb6\344\270\x8d\xe5\xad\230\345\234\xa8\xef\xbc\x81"); goto IxZDI; RcT2x: if (file_exists($this->_UTF82GBK("\56\x2e\x2f" . $path . $name))) { goto BY2a7; } goto XGHg4; NkVmf: BdSHy: goto D1xcX; z4lZy: $path = $request_data["\x70\x61\164\150"]; goto mCmiF; h0Lzu: return $this->success($name . "\x20\xe6\226\207\xe4\273\266\345\267\262\xe5\255\230\xe5\234\250\357\xbc\x81"); goto NkVmf; vn3hj: BY2a7: goto h0Lzu; D1xcX: } protected function postDelete($request_data) { goto umYc6; umYc6: $ids = $request_data["\151\x64"]; goto wEmv5; lDrqI: NxPTu: goto pMHtZ; pMHtZ: return $this->success(); goto v8zCv; wEmv5: foreach ($ids as $id) { goto ZF0xB; ZF0xB: $file = $this->db->select($this->table, array("\x70\141\x74\x68", "\156\141\x6d\x65"))->where(array("\x69\x64", "\x3d", $id))->get(); goto wK6_j; kV5y3: goto jmBaf; goto m8lxt; wsMSg: $name = $file["\156\x61\x6d\x65"]; goto XWchl; XWchl: if (!(!$path || stripos($path, "\144\141\x74\141\x2f\146\x69\x6e\144\x65\162\x2f") === false || $name == null || $name == '')) { goto KdpiQ; } goto Cw5QO; JsLWu: Vv6k7: goto QSpYo; ejSGr: jmBaf: goto IBFj6; IBFj6: Ik0Kx: goto x6MKy; QSpYo: if (!$this->db->delete($this->table, array("\x69\x64", "\75", $id))->is()) { goto N87iH; } goto ePz64; tWGlH: Fa2v3: goto AW_d0; ARqsl: if (is_dir($filename)) { goto zEj1C; } goto WALOf; pRdTw: KdpiQ: goto kb58n; m8lxt: zEj1C: goto vwJNA; Cw5QO: $this->db->delete($this->table, array("\x69\144", "\75", $id))->is(); goto nKN9e; wK6_j: if ($file) { goto Fa2v3; } goto N_z5n; mGTv7: GpPr0: goto ejSGr; vwJNA: if (!$this->db->delete($this->table, array("\154\145\166\145\x6c", "\114\111\113\105", "\x25\x2c{$id}\x2c\x25"))->is()) { goto GpPr0; } goto rDR5r; nKN9e: goto Ik0Kx; goto pRdTw; LOuip: goto jmBaf; goto JsLWu; ePz64: @unlink($filename); goto HVl2s; rDR5r: $this->_rmdir($filename); goto mGTv7; HVl2s: N87iH: goto kV5y3; N_z5n: goto Ik0Kx; goto tWGlH; AW_d0: $path = $file["\x70\141\164\150"]; goto wsMSg; WALOf: $this->db->delete($this->table, array("\x6c\x65\x76\145\x6c", "\x4c\x49\x4b\105", "\45\x2c{$id}\x2c\45")); goto LOuip; kb58n: $filename = $this->_UTF82GBK("\56\x2e\x2f" . $path . $name); goto vzuYx; vzuYx: if (is_file($filename)) { goto Vv6k7; } goto ARqsl; x6MKy: } goto lDrqI; v8zCv: } protected function getCurPath($foid) { goto hEBLP; Azz2E: $level = array_filter(explode("\54", $level)); goto lkGEL; djAk_: return $this->success('', $data); goto QdIqD; lkGEL: $data = $this->db->select($this->table, array("\x69\144", "\156\141\155\x65"))->where(array(array("\151\144", "\111\116", $level), "\101\x4e\x44", array("\x74\x79\x70\145", "\75", "\x66\157\x6c\x64\145\x72")))->all(); goto djAk_; hEBLP: $level = $this->db->select($this->table, "\154\145\166\x65\x6c")->where(array("\151\144", "\x3d", $foid))->get(0); goto Azz2E; QdIqD: } }
